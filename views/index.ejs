<!DOCTYPE html>
<html>

<head>
  <title>UI Usage Stats</title>
  <script src="/echarts.js"></script>
</head>

<body>
  <div id="component-usage" style="width: 100%;height:500px;"></div>
  <div id="file-component-usage" style="width: 100%;height:500px;"></div>
  <div id="file-line-count" style="width: 100%;height:500px;"></div>
  <div id="file-name" style="width: 100%;height:500px;">
    <h3>File Name Stats</h3>
    <div class="name-box">
      <div class="th">
        <p>文件名称</p>
        <p>文件大小</p>
        <p>最后修改时间</p>
      </div>
      <% fileName.forEach(function({name, size, mtime}) { %>
       <div class="table">
         <p>
          <%= name %>
         </p>
         <p>
          <%= size %>
         </p>
         <p>
          <%= mtime %>
         </p>
       </div>
      <% }); %>
    </div>
  </div>
  <!-- <%- JSON.stringify(fileName.map((name) => ({name: name, value: 1}))) %> -->

  
  <script>
    var componentUsage = echarts.init(document.getElementById('component-usage'));
    var componentUsageOption = {
      title: {
        text: 'UI Component Usage Stats',
        left: 'center'
      },
      tooltip: {

      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      xAxis: {
        data: <%- JSON.stringify(componentUsage.map(([name, count]) => name)) %> ,
        axisLabel: {
          interval: 0,
          rotate: 40
        }
      },
      yAxis: {},
      yAxis: {},
      series: [{
        name: 'UI Component Usage',
        type: 'bar',
        data: <%- JSON.stringify(componentUsage.map(([name, count]) => count)) %> ,
        label: {
          show: true,
          position: 'top'
        },
        markPoint: {
          data: [
            { type: 'max', name: 'Max' },
            { type: 'min', name: 'Min' }
          ]
        }
      }]
    };
    componentUsage.setOption(componentUsageOption);
  </script>
 <script>
   

    var fileComponentUsageDom = echarts.init(document.getElementById('file-component-usage'));
    var fileComponentUsage = <%- JSON.stringify(fileComponentUsage) %>;
    var files = Object.keys(fileComponentUsage);
    var components = Array.from(new Set([].concat(...files.map(file => Object.keys(fileComponentUsage[file])))));
    var series = components.map(component => ({
      name: component,
      type: 'bar',
      stack: 'total',
      data: files.map(file => fileComponentUsage[file][component] || 0)
    }));
    var fileComponentUsageOption = {
      title: {
        text: 'File Component Usage Stats',
        left: 'center'
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      tooltip: {},
      // legend: {
      //   data: components
      // },
      xAxis: {
        data: files,
        axisLabel: {
          interval: 0,
          rotate: 45
        }
      },
      yAxis: {},
      series: series
    };
    fileComponentUsageDom.setOption(fileComponentUsageOption);
  </script>
  </script> 
  <script>
    var fileLineCountDom = echarts.init(document.getElementById('file-line-count'));
    var fileLineCountOption = {
      title: {
        text: 'File LineCount Stats',
        left: 'center'
      },
      tooltip: {

      },
      xAxis: {
        data: <%- JSON.stringify(fileLineCount.map(([name, count]) => name)) %> ,
        axisLabel: {
          interval: 0,
          rotate: 40
        }
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
      },
      yAxis: {},
      series: [{
        name: 'File LineCount',
        type: 'bar',
        data: <%- JSON.stringify(fileLineCount.map(([name, count]) => count)) %> ,
        label: {
          show: true,
          position: 'top'
        },
        markPoint: {
          data: [
            { type: 'max', name: 'Max' },
            { type: 'min', name: 'Min' }
          ]
        }
      }]
    };
    fileLineCountDom.setOption(fileLineCountOption);
  </script>
  
   <!-- <script>
    var fileNameDom = echarts.init(document.getElementById('file-name'));
    var fileNameOption = {
      title: {
        text: 'File Name Usage Stats',
        left: 'center'
      },
      series: [{
        type: 'wordCloud',
        gridSize: 2,
        sizeRange: [12, 50],
        rotationRange: [-90, 90],
        shape: 'pentagon',
        width: 600,
        height: 400,
        drawOutOfBound: true,
        textStyle: {
          normal: {
            color: function () {
              return 'rgb(' + [
                Math.round(Math.random() * 160),
                Math.round(Math.random() * 160),
                Math.round(Math.random() * 160)
              ].join(',') + ')';
            }
          },
          emphasis: {
            shadowBlur: 10,
            shadowColor: '#333'
          }
        },
        data: <%- JSON.stringify(fileName.map((name) => ({name: name, value: 1}))) %>
      }]
    };
    fileNameDom.setOption(fileNameOption);
  </script> -->
  <style>
    div + div {
      margin-top:30px;
    }
    h3 {
      text-align: center;
    }
    .name-box {
      overflow: auto;
      
      flex-wrap: wrap;
      padding: 0 30px;
      padding-bottom: 100px;
    }
    .name-box .table, .name-box .th {
      display: flex;
      gap: 10px;
    }
    .name-box .table p, .name-box .th p{
      margin: 0;
      border:1px solid #909399;
      color: #909399;
      border-radius: 4px;
      padding: 2px 4px;
      flex: 1;
    }
    .name-box .th p{
      border:2px solid #909399;
      font-weight: bold;
    }
  </style>
</body>

</html>